#!/bin/bash -ex

# Before running, make sure to satisfy all the deps via:
# apt-get install build-essential devscripts debhelper gnupg

dpkg -l build-essential devscripts debhelper gnupg >/dev/null

export DEBFULLNAME="Metacloud"
export DEBEMAIL="syseng@metacloud.com"
export KEY_ID="AEB0C71E"

MAIN_VERSION=2.1.0
SVN_REV=`svn info | grep Revision | cut -f2 -d' '`

echo
echo
echo "Answer Y to the dumb prompt."
echo
echo

dch -D oneiric -u critical \
    -v ${MAIN_VERSION}-svn${SVN_REV} "Autogenerated build"

dch -D natty -u critical \
    -v ${MAIN_VERSION}-svn${SVN_REV} "Autogenerated build"

debuild -S -k${KEY_ID}

dput ppa:metacloud/stable \
    ../spine_2.1.0-svn${SVN_REV}_source.changes

svn revert debian/changelog
