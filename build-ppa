#!/bin/bash -ex

# Before running, make sure to satisfy all the deps via:
# apt-get install build-essential devscripts debhelper gnupg

dpkg -l build-essential devscripts debhelper gnupg >/dev/null

export DEBFULLNAME="Metacloud"
export DEBEMAIL="syseng@metacloud.com"
export KEY_ID="AEB0C71E"
export SERIES="oneiric"
export DEBUILD_TGZ_CHECK="no"

MAIN_VERSION=2.1.0
SVN_REV=`svn info | grep Revision | cut -f2 -d' '`

echo
echo
echo "Answer Y to the dumb prompt."
echo
echo

for DIST in $SERIES ; do
    svn revert debian/changelog

    dch -D $DIST -u critical \
        -v ${MAIN_VERSION}-svn${SVN_REV}-${DIST} "Autogenerated build"

    debuild -S -k${KEY_ID}

    dput ppa:metacloud/stable \
        ../spine_${MAIN_VERSION}-svn${SVN_REV}-${DIST}_source.changes

    svn revert debian/changelog
done
